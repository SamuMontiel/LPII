<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>VirtualHub - Tienda</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body>

<header class="navbar">
    <div class="logo">VirtualHub</div>

    <div class="user-info">
        <span th:text="${usuario.nombre}"></span>

        <span class="saldo">
            S/ <span th:text="${#numbers.formatDecimal(usuario.saldo, 1, 2)}"></span>
        </span>

        <a th:href="@{/biblioteca}" class="btn-nav">Biblioteca</a>

        <form th:action="@{/logout}" method="post" style="display:inline;">
            <button type="submit" class="btn-logout">Cerrar sesiÃ³n</button>
        </form>
    </div>
</header>


<!-- ================= HERO SLIDER ================= -->

<section class="hero-slider" th:if="${juegos.size() > 0}">

    <div class="hero-slide"
         th:each="juego,iter : ${juegos}"
         th:classappend="${iter.index == 0} ? ' active' : ''"
         th:style="'background-image:url(' + ${juego.coverUrl} + ')'">

        <div class="hero-overlay"></div>

        <div class="hero-content">

            <h1 th:text="${juego.titulo}"></h1>

            <p th:text="${juego.descripcion}"></p>

            <div class="hero-price">
                S/ <span th:text="${juego.precio}"></span>
            </div>

            <div th:if="${juegosComprados.contains(juego.id)}">
                <button class="btn-disabled" disabled>
                    En tu biblioteca
                </button>
            </div>

            <div th:unless="${juegosComprados.contains(juego.id)}">
                <form th:action="@{/comprar/{id}(id=${juego.id})}" method="post">
                    <button class="btn-comprar hero-btn">
                        Comprar ahora
                    </button>
                </form>
            </div>

        </div>
    </div>

    <!-- INDICADORES -->
    <div class="hero-indicators">
        <span th:each="juego,iter : ${juegos}"
              th:classappend="${iter.index == 0} ? ' active' : ''"></span>
    </div>

</section>


<!-- ================= OFERTAS ================= -->

<section class="special-offers" th:if="${juegos.size() > 0}">
    <h2 class="section-title">ðŸ”¥ Ofertas especiales</h2>

    <div class="offers-row">

        <div class="offer-card"
             th:each="juego,iter : ${juegos}"
             th:if="${iter.index < 3}">

            <img th:src="@{${juego.coverUrl}}">

            <div class="offer-badge">-30%</div>

            <div class="offer-info">
                <h3 th:text="${juego.titulo}"></h3>
                <span class="offer-price">
                    S/ <span th:text="${juego.precio}"></span>
                </span>
            </div>

        </div>

    </div>
</section>


<!-- ================= TIENDA ================= -->

<main class="store-container">

    <h2 class="section-title">Tienda</h2>

    <div class="games-grid">

        <div class="game-card" th:each="juego : ${juegos}">

            <img th:src="@{${juego.coverUrl}}" class="game-image">

            <div class="game-info">

                <h3 th:text="${juego.titulo}"></h3>

                <p th:text="${juego.descripcion}"></p>

                <div class="price">
                    S/ <span th:text="${juego.precio}"></span>
                </div>

                <div th:if="${juegosComprados.contains(juego.id)}">
                    <button class="btn-disabled" disabled>
                        En la biblioteca
                    </button>
                </div>

                <div th:unless="${juegosComprados.contains(juego.id)}">
                    <form th:action="@{/comprar/{id}(id=${juego.id})}" method="post">
                        <button class="btn-comprar" type="submit">
                            Comprar
                        </button>
                    </form>
                </div>

            </div>

        </div>

    </div>

</main>


<!-- ================= SLIDER JS ================= -->

<script>
document.addEventListener("DOMContentLoaded", function() {

    const slides = document.querySelectorAll(".hero-slide");
    const indicators = document.querySelectorAll(".hero-indicators span");

    if (slides.length === 0) return;

    let current = 0;

    function showSlide(index) {
        slides.forEach(s => s.classList.remove("active"));
        indicators.forEach(i => i.classList.remove("active"));

        slides[index].classList.add("active");
        indicators[index].classList.add("active");

        current = index;
    }

    function nextSlide() {
        let next = current + 1;
        if (next >= slides.length) next = 0;
        showSlide(next);
    }

    setInterval(nextSlide, 5000);

    indicators.forEach((indicator, index) => {
        indicator.addEventListener("click", () => showSlide(index));
    });

    // AnimaciÃ³n botÃ³n comprar
    document.querySelectorAll(".btn-comprar").forEach(btn => {
        btn.addEventListener("click", function() {
            btn.innerText = "Procesando...";
            btn.style.background = "#1f6ed4";
        });
    });

});
</script>

</body>
</html>