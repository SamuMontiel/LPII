<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>VirtualHub - Carrito</title>
    <link rel="stylesheet" th:href="@{/css/carrito.css}">
</head>
<body>

<header class="navbar">
    <div class="logo">VirtualHub</div>

    <nav class="nav-links">
        <a th:href="@{/home}">Home</a>
        <a th:href="@{/biblioteca}">Biblioteca</a>
    </nav>

    <div class="saldo-box">
        Saldo: S/ <span th:text="${usuario.saldo}"></span>
    </div>
</header>

<main class="carrito-container">

    <h2>Mi Carrito</h2>

    <table class="tabla-carrito">
        <thead>
            <tr>
                <th>Juego</th>
                <th>Precio</th>
                <th>Acción</th>
            </tr>
        </thead>

        <tbody>
            <tr th:each="item : ${items}">
                <td th:text="${item.juego.titulo}"></td>
                <td>S/ <span th:text="${item.juego.precio}"></span></td>
                <td>
                    <form th:action="@{'/carrito/eliminar/' + ${item.id}}" method="post">
                        <button type="submit" class="btn-eliminar">
                            Eliminar
                        </button>
                    </form>
                </td>
            </tr>
        </tbody>
    </table>

    <div class="confirmar-box">
        <form th:action="@{/carrito/confirmar}" method="post">
            <input type="hidden"
                   th:name="${_csrf.parameterName}"
                   th:value="${_csrf.token}" />

            <button type="submit" class="btn-confirmar">
                Confirmar compra
            </button>
        </form>
    </div>

</main>

<!-- Canvas Partículas -->
<canvas id="particles"></canvas>

<script>
    // ===== Partículas =====
    const canvas = document.getElementById("particles");
    const ctx = canvas.getContext("2d");

    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let particlesArray = [];

    class Particle {
        constructor(){
            this.x = Math.random() * canvas.width;
            this.y = Math.random() * canvas.height;
            this.size = Math.random() * 2;
            this.speedX = (Math.random() - 0.5) * 0.5;
            this.speedY = (Math.random() - 0.5) * 0.5;
        }
        update(){
            this.x += this.speedX;
            this.y += this.speedY;

            if(this.x > canvas.width) this.x = 0;
            if(this.x < 0) this.x = canvas.width;
            if(this.y > canvas.height) this.y = 0;
            if(this.y < 0) this.y = canvas.height;
        }
        draw(){
            ctx.fillStyle = "#00bfff";
            ctx.beginPath();
            ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
            ctx.fill();
        }
    }

    function init(){
        particlesArray = [];
        for(let i = 0; i < 100; i++){
            particlesArray.push(new Particle());
        }
    }

    function animate(){
        ctx.clearRect(0,0,canvas.width,canvas.height);
        particlesArray.forEach(p => {
            p.update();
            p.draw();
        });
        requestAnimationFrame(animate);
    }

    init();
    animate();

    window.addEventListener("resize", function(){
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        init();
    });
</script>
</body>
</html>